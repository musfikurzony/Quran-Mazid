<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <title>Qur'an ‚Ä¢ Word-by-Word</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    :root {
      --bg-main: #050712;
      --bg-elevated: #0b1020;
      --bg-elevated-soft: #101528;
      --bg-hover: #151b30;
      --accent: #f0b34a;
      --accent-soft: rgba(240, 179, 74, 0.12);
      --accent-strong: #ffcc66;
      --accent-red: #ff6b6b;
      --accent-green: #4cd964;
      --text-main: #f9fafb;
      --text-soft: #cbd5f5;
      --text-muted: #9ca3c9;
      --border-subtle: #272c3f;
      --badge-bg: #111827;
      --danger: #f97373;
      --shadow-soft: 0 18px 35px rgba(0, 0, 0, 0.55);

      --font-arabic-size: 26px;
      --font-bangla-size: 16px;
      --font-bangla-default-size: 15px;
      --font-translation-size: 15px;
      --font-word-meaning-size: 14px;
      --font-grammar-size: 13px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        "Noto Sans Bengali", sans-serif;
      background: radial-gradient(circle at top, #101426 0, #050712 55%, #000 100%);
      color: var(--text-main);
      display: flex;
      min-height: 100vh;
    }

    /* Layout */

    .app-shell {
      display: flex;
      flex: 1;
      max-width: 1200px;
      margin: 0 auto;
      width: 100%;
    }

    .sidebar {
      width: 280px;
      background: rgba(2, 6, 23, 0.98);
      border-right: 1px solid var(--border-subtle);
      box-shadow: 15px 0 25px rgba(0, 0, 0, 0.6);
      padding: 12px 10px 16px;
      display: flex;
      flex-direction: column;
      position: relative;
      z-index: 40;
    }

    .sidebar-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
    }

    .app-title {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 15px;
      font-weight: 600;
      letter-spacing: 0.02em;
    }

    .app-title-icon {
      width: 20px;
      height: 20px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 30%, #fef9c3, #facc15, #b45309);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #020617;
      font-size: 11px;
      font-weight: 800;
      box-shadow: 0 0 0 1px rgba(248, 250, 252, 0.45), 0 6px 15px rgba(0, 0, 0, 0.8);
    }

    .hamburger-btn {
      background: transparent;
      border: none;
      color: var(--accent-strong);
      font-size: 22px;
      line-height: 1;
      cursor: pointer;
      padding: 4px 8px;
    }

    .sidebar-section-title {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--text-muted);
      margin: 8px 2px 4px;
    }

    .sura-search {
      margin-bottom: 8px;
    }

    .sura-search input {
      width: 100%;
      padding: 7px 8px;
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      background: rgba(15, 23, 42, 0.9);
      color: var(--text-main);
      font-size: 12px;
      outline: none;
    }

    .sura-search input::placeholder {
      color: var(--text-muted);
    }

    .sura-list {
      flex: 1;
      overflow-y: auto;
      padding-right: 4px;
      margin-bottom: 10px;
    }

    .sura-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 6px 7px;
      border-radius: 10px;
      cursor: pointer;
      margin-bottom: 3px;
      transition: background 0.14s ease, transform 0.06s ease;
      font-size: 13px;
    }

    .sura-item:hover {
      background: rgba(30, 64, 175, 0.35);
      transform: translateY(-0.5px);
    }

    .sura-item.active {
      background: linear-gradient(90deg, #1e293b, #0f172a);
      border: 1px solid rgba(248, 250, 252, 0.06);
      box-shadow: 0 0 0 1px rgba(248, 250, 252, 0.06);
    }

    .sura-info-main {
      display: flex;
      flex-direction: column;
      gap: 1px;
    }

    .sura-name-bn {
      font-size: 13px;
      font-weight: 600;
    }

    .sura-name-ar {
      font-size: 11px;
      color: var(--text-soft);
    }

    .sura-meta {
      text-align: right;
      font-size: 10px;
      color: var(--text-muted);
    }

    .sura-badge {
      padding: 2px 6px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.3);
      font-size: 10px;
      display: inline-flex;
      gap: 4px;
      align-items: center;
      justify-content: center;
    }

    .last-read-card {
      background: linear-gradient(135deg, rgba(15, 23, 42, 0.95), #020617);
      border-radius: 14px;
      padding: 8px 9px;
      border: 1px solid rgba(55, 65, 81, 0.7);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.65);
      margin-bottom: 10px;
      font-size: 11px;
    }

    .last-read-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 4px;
    }

    .last-read-label {
      text-transform: uppercase;
      letter-spacing: 0.16em;
      font-size: 10px;
      color: var(--text-muted);
    }

    .last-read-ref {
      font-size: 11px;
      font-weight: 600;
      color: var(--accent-strong);
      padding: 2px 7px;
      border-radius: 999px;
      background: rgba(17, 24, 39, 0.7);
      border: 1px solid rgba(245, 158, 11, 0.35);
    }

    .last-read-body {
      margin-bottom: 6px;
      color: var(--text-soft);
    }

    .last-read-actions {
      display: flex;
      justify-content: space-between;
      gap: 4px;
    }

    .last-read-btn {
      flex: 1;
      border-radius: 999px;
      border: none;
      padding: 5px 6px;
      font-size: 11px;
      cursor: pointer;
    }

    .btn-continue {
      background: var(--accent);
      color: #020617;
      font-weight: 600;
    }

    .btn-clear-last {
      background: transparent;
      color: var(--text-muted);
      border: 1px solid rgba(75, 85, 99, 0.8);
    }

    .bottom-controls {
      display: flex;
      gap: 6px;
      margin-top: 6px;
    }

    .bottom-btn {
      flex: 1;
      border-radius: 999px;
      border: 1px solid rgba(55, 65, 81, 0.8);
      background: rgba(15, 23, 42, 0.95);
      color: var(--text-soft);
      font-size: 11px;
      padding: 5px 6px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
    }

    .bottom-btn span.icon {
      font-size: 12px;
    }

    /* Main content */

    .main {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 10px 8px 12px;
      position: relative;
    }

    .top-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
      padding: 6px 8px;
      border-radius: 999px;
      border: 1px solid rgba(30, 64, 175, 0.55);
      background: radial-gradient(circle at top left, rgba(30, 64, 175, 0.35), rgba(15, 23, 42, 0.97));
      box-shadow: 0 12px 30px rgba(15, 23, 42, 0.8);
      position: relative;
      z-index: 20;
    }

    .top-left {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .top-app-title {
      font-size: 13px;
      font-weight: 600;
    }

    .top-right {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .chip {
      border-radius: 999px;
      padding: 3px 8px;
      font-size: 11px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      color: var(--text-soft);
      background: rgba(15, 23, 42, 0.9);
      display: inline-flex;
      align-items: center;
      gap: 4px;
      cursor: default;
    }

    .settings-btn {
      border-radius: 999px;
      border: 1px solid rgba(129, 140, 248, 0.7);
      background: radial-gradient(circle at top, rgba(55, 65, 194, 0.8), rgba(15, 23, 42, 1));
      color: #e5e7eb;
      padding: 5px 10px;
      font-size: 11px;
      display: flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      box-shadow: 0 8px 20px rgba(17, 24, 39, 0.7);
    }

    .settings-btn span.icon {
      font-size: 14px;
    }

    .sura-header {
      margin-bottom: 6px;
      padding: 6px 9px;
      border-radius: 12px;
      background: rgba(15, 23, 42, 0.92);
      border: 1px solid rgba(31, 41, 55, 0.8);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 6px;
    }

    .sura-header-info {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .sura-header-title {
      font-size: 15px;
      font-weight: 600;
    }

    .sura-header-sub {
      font-size: 11px;
      color: var(--text-soft);
    }

    .sura-header-meta {
      text-align: right;
      font-size: 11px;
      color: var(--text-muted);
    }

    .sura-header-meta .badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 2px 7px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: rgba(15, 23, 42, 0.9);
    }

    /* Ayaat content area */

    .content-scroll {
      flex: 1;
      overflow-y: auto;
      padding-right: 4px;
      padding-bottom: 40px;
      position: relative;
    }

    .ayah-card {
      margin-bottom: 10px;
      padding: 8px 9px 7px;
      border-radius: 14px;
      background: rgba(15, 23, 42, 0.95);
      border: 1px solid rgba(31, 41, 55, 0.9);
      box-shadow: 0 10px 24px rgba(0, 0, 0, 0.65);
      position: relative;
    }

    .ayah-card:hover {
      border-color: rgba(59, 130, 246, 0.7);
    }

    .ayah-top-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 4px;
    }

    .ayah-ref-badge {
      padding: 3px 8px;
      border-radius: 999px;
      font-size: 11px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.55);
      color: var(--accent-strong);
      display: inline-flex;
      align-items: center;
      gap: 5px;
    }

    .ayah-ref-badge span.index {
      color: var(--text-soft);
    }

    .ayah-actions {
      position: relative;
    }

    .more-btn {
      border: none;
      background: rgba(15, 23, 42, 0.9);
      border-radius: 999px;
      padding: 3px 8px;
      cursor: pointer;
      color: var(--text-soft);
      border: 1px solid rgba(55, 65, 81, 0.9);
      font-size: 14px;
    }

    .more-menu {
      position: absolute;
      top: 130%;
      right: 0;
      background: rgba(15, 23, 42, 1);
      border-radius: 10px;
      border: 1px solid rgba(55, 65, 81, 0.95);
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.8);
      min-width: 150px;
      z-index: 30;
      display: none;
    }

    .more-menu.open {
      display: block;
    }

    .more-menu button {
      width: 100%;
      text-align: left;
      background: transparent;
      border: none;
      color: var(--text-soft);
      font-size: 12px;
      padding: 7px 10px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .more-menu button:hover {
      background: rgba(30, 64, 175, 0.5);
      color: #f9fafb;
    }

    .ayah-arabic-line {
      direction: rtl;
      text-align: right;
      font-family: "Scheherazade New", "Amiri", "Noto Naskh Arabic", serif;
      font-size: var(--font-arabic-size);
      line-height: 1.7;
      margin-bottom: 4px;
    }

    .ayah-arabic-word {
      display: inline-block;
      padding: 2px 5px;
      margin: 0 1.5px 3px;
      border-radius: 7px;
      cursor: pointer;
      transition: background 0.12s ease, transform 0.06s ease, box-shadow 0.12s ease;
      border: 1px solid transparent;
    }

    .ayah-arabic-word:hover {
      background: var(--accent-soft);
      border-color: rgba(250, 204, 21, 0.5);
      transform: translateY(-0.5px);
      box-shadow: 0 0 0 1px rgba(250, 250, 250, 0.05);
    }

    .ayah-arabic-word.active {
      background: rgba(30, 64, 175, 0.8);
      border-color: rgba(191, 219, 254, 0.9);
      box-shadow: 0 0 0 1px rgba(219, 234, 254, 0.7);
    }

    .ayah-bangla-main {
      font-size: var(--font-bangla-size);
      line-height: 1.7;
      color: var(--text-soft);
      margin-bottom: 4px;
    }

    .ayah-translations {
      border-radius: 10px;
      background: rgba(15, 23, 42, 0.98);
      border: 1px dashed rgba(75, 85, 99, 0.9);
      padding: 6px 8px;
      margin-bottom: 4px;
    }

    .translation-item {
      font-size: var(--font-translation-size);
      margin-bottom: 3px;
      color: var(--text-soft);
    }

    .translation-label {
      font-size: 11px;
      color: var(--text-muted);
      margin-right: 4px;
    }

    .word-meaning-line {
      font-size: var(--font-word-meaning-size);
      color: var(--text-soft);
      margin-bottom: 3px;
    }

    .grammar-notes {
      font-size: var(--font-grammar-size);
      color: var(--text-muted);
      border-top: 1px dashed rgba(75, 85, 99, 0.8);
      padding-top: 4px;
      margin-top: 3px;
    }

    /* Word meaning popup */

    .word-popup {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      background: radial-gradient(circle at top, #0b1020, #020617 60%, #000 100%);
      border-top-left-radius: 18px;
      border-top-right-radius: 18px;
      border-top: 1px solid rgba(55, 65, 81, 0.9);
      box-shadow: 0 -14px 30px rgba(0, 0, 0, 0.85);
      padding: 10px 12px 12px;
      max-height: 52vh;
      overflow-y: auto;
      z-index: 60;
    }

    .word-popup-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
    }

    .word-popup-title {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .word-popup-ar {
      direction: rtl;
      text-align: right;
      font-family: "Scheherazade New", "Amiri", "Noto Naskh Arabic", serif;
      font-size: calc(var(--font-arabic-size) - 2px);
    }

    .word-popup-bn {
      font-size: var(--font-word-meaning-size);
      color: var(--text-soft);
    }

    .word-popup-close {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: rgba(15, 23, 42, 1);
      color: var(--text-soft);
      padding: 4px 8px;
      font-size: 11px;
      cursor: pointer;
    }

    .word-popup-notes {
      font-size: var(--font-grammar-size);
      color: var(--text-muted);
      margin-top: 4px;
      border-top: 1px dashed rgba(75, 85, 99, 0.9);
      padding-top: 4px;
    }

    /* Settings modal */

    .settings-modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.8);
      display: flex;
      align-items: flex-end;
      justify-content: center;
      z-index: 70;
    }

    .settings-modal {
      width: 100%;
      max-width: 540px;
      max-height: 90vh;
      background: radial-gradient(circle at top left, #111827, #020617 60%, #020617);
      border-radius: 16px 16px 0 0;
      border-top: 1px solid rgba(55, 65, 81, 0.9);
      padding: 10px 12px 14px;
      box-shadow: 0 -18px 40px rgba(0, 0, 0, 0.9);
      overflow-y: auto;
    }

    .settings-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .settings-title {
      font-size: 14px;
      font-weight: 600;
    }

    .settings-close-btn {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: rgba(15, 23, 42, 1);
      color: var(--text-soft);
      padding: 3px 8px;
      font-size: 11px;
      cursor: pointer;
    }

    .settings-section {
      margin-bottom: 10px;
      padding: 8px 9px;
      border-radius: 12px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(31, 41, 55, 0.9);
    }

    .settings-section-title {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: var(--text-muted);
      margin-bottom: 4px;
    }

    .toggle-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 4px;
      font-size: 12px;
    }

    .toggle-row label {
      flex: 1;
      margin-right: 8px;
    }

    .toggle-input {
      width: 38px;
      height: 20px;
      border-radius: 999px;
      background: #111827;
      border: 1px solid rgba(55, 65, 81, 0.9);
      position: relative;
      cursor: pointer;
      flex-shrink: 0;
    }

    .toggle-input::after {
      content: "";
      position: absolute;
      top: 2px;
      left: 3px;
      width: 14px;
      height: 14px;
      border-radius: 999px;
      background: #4b5563;
      transition: all 0.16s ease;
    }

    .toggle-input.active {
      background: rgba(34, 197, 94, 0.09);
      border-color: rgba(34, 197, 94, 0.9);
    }

    .toggle-input.active::after {
      transform: translateX(14px);
      background: #22c55e;
    }

    .font-control-row {
      display: flex;
      flex-direction: column;
      margin-bottom: 6px;
      font-size: 12px;
    }

    .font-control-label {
      margin-bottom: 2px;
      color: var(--text-soft);
    }

    .font-control-inputs {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .font-number-input {
      width: 52px;
      padding: 3px 4px;
      border-radius: 8px;
      border: 1px solid rgba(55, 65, 81, 0.9);
      background: rgba(15, 23, 42, 0.95);
      color: var(--text-main);
      font-size: 11px;
      text-align: center;
    }

    .font-range-input {
      flex: 1;
      -webkit-appearance: none;
      appearance: none;
      height: 4px;
      border-radius: 999px;
      background: rgba(31, 41, 55, 0.95);
      outline: none;
    }

    .font-range-input::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 14px;
      height: 14px;
      border-radius: 999px;
      background: var(--accent);
      border: 1px solid rgba(30, 64, 175, 1);
      box-shadow: 0 0 0 3px rgba(234, 179, 8, 0.35);
      cursor: pointer;
    }

    .font-range-input::-moz-range-thumb {
      width: 14px;
      height: 14px;
      border-radius: 999px;
      background: var(--accent);
      border: 1px solid rgba(30, 64, 175, 1);
      box-shadow: 0 0 0 3px rgba(234, 179, 8, 0.35);
      cursor: pointer;
    }

    /* Fullscreen mode */

    .fullscreen .top-bar {
      display: none;
    }
    .fullscreen .sidebar {
      display: none;
    }
    .fullscreen .main {
      padding-top: 6px;
      padding-left: 10px;
      padding-right: 10px;
    }

    .fullscreen-hint {
      position: fixed;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(15, 23, 42, 0.9);
      color: var(--text-soft);
      padding: 4px 8px;
      border-radius: 999px;
      font-size: 11px;
      border: 1px solid rgba(75, 85, 99, 0.9);
      box-shadow: 0 8px 18px rgba(0, 0, 0, 0.8);
      z-index: 80;
    }

    /* Responsive */

    @media (max-width: 900px) {
      .sidebar {
        position: fixed;
        top: 0;
        bottom: 0;
        left: 0;
        transform: translateX(-100%);
        transition: transform 0.18s ease-out;
      }
      .sidebar.open {
        transform: translateX(0);
      }
      .main {
        padding: 8px 6px 10px;
      }
      .top-bar {
        border-radius: 12px;
      }
    }

    @media (max-width: 600px) {
      .ayah-card {
        padding: 7px 7px 6px;
      }
      .ayah-arabic-line {
        font-size: calc(var(--font-arabic-size) - 2px);
      }
    }

  </style>
</head>
<body>
  <div class="app-shell">

    <!-- Sidebar: Sura list + last read -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="app-title">
          <div class="app-title-icon">Ô∑Ω</div>
          <span>Qur'an ‚Ä¢ Word-by-Word</span>
        </div>
        <button class="hamburger-btn" id="sidebarClose">‚â°</button>
      </div>

      <div class="last-read-card" id="lastReadCard">
        <div class="last-read-top">
          <div class="last-read-label">‡¶∂‡ßá‡¶∑ ‡¶™‡ßú‡¶æ</div>
          <div class="last-read-ref" id="lastReadRef">-</div>
        </div>
        <div class="last-read-body" id="lastReadPreview">
          ‡¶è‡¶ñ‡¶®‡ßã ‡¶ï‡ßã‡¶® ‡¶Ü‡ßü‡¶æ‡¶§‡¶ï‡ßá ‡¶∂‡ßá‡¶∑ ‡¶™‡ßú‡¶æ ‡¶π‡¶ø‡¶∏‡ßá‡¶¨‡ßá ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡¶®‡¶ø‡•§
        </div>
        <div class="last-read-actions">
          <button class="last-read-btn btn-continue" id="btnContinueLast">
            ‚è± ‡¶è‡¶ñ‡¶æ‡¶® ‡¶•‡ßá‡¶ï‡ßá ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®
          </button>
          <button class="last-read-btn btn-clear-last" id="btnClearLast">
            ‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®
          </button>
        </div>
      </div>

      <div class="sidebar-section-title">‡¶∏‡ßÅ‡¶∞‡¶æ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶®</div>

      <div class="sura-search">
        <input type="text" id="suraSearchInput" placeholder="‡¶∏‡ßÅ‡¶∞‡¶æ ‡¶®‡¶æ‡¶Æ / ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶¶‡¶ø‡ßü‡ßá ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®‚Ä¶" />
      </div>

      <div class="sura-list" id="suraList">
        <!-- JS will render -->
      </div>

      <div class="bottom-controls">
        <button class="bottom-btn" id="openPinsFav">
          <span class="icon">‚≠ê</span>
          <span>Pin / Favourite</span>
        </button>
        <button class="bottom-btn" id="openSettingsBottom">
          <span class="icon">‚öôÔ∏è</span>
          <span>Settings</span>
        </button>
      </div>
    </aside>

    <!-- Main content -->
    <main class="main" id="mainArea">

      <div class="top-bar" id="topBar">
        <div class="top-left">
          <button class="hamburger-btn" id="sidebarOpen">‚â°</button>
          <div class="top-app-title">Qur'an ‚Ä¢ Word-by-Word</div>
          <span class="chip" id="currentSuraChip">‡¶ï‡ßã‡¶® ‡¶∏‡ßÅ‡¶∞‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡ßü‡¶®‡¶ø</span>
        </div>
        <div class="top-right">
          <span class="chip" id="viewModeChip">Arabic + ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ</span>
          <button class="settings-btn" id="settingsBtn">
            <span class="icon">‚öôÔ∏è</span>
            <span>‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏</span>
          </button>
        </div>
      </div>

      <div class="sura-header" id="suraHeader">
        <div class="sura-header-info">
          <div class="sura-header-title" id="suraHeaderTitle">‡¶∏‡ßÅ‡¶∞‡¶æ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</div>
          <div class="sura-header-sub" id="suraHeaderSub">‡¶¨‡¶æ‡¶Æ ‡¶™‡¶æ‡¶∂ ‡¶•‡ßá‡¶ï‡ßá ‡¶ï‡ßã‡¶®‡ßã ‡¶∏‡ßÅ‡¶∞‡¶æ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</div>
        </div>
        <div class="sura-header-meta">
          <div class="badge" id="suraMetaBadge">
            <span id="suraMetaRevelation">-</span>
            <span>‚Ä¢</span>
            <span id="suraMetaAyat">- ‡¶Ü‡ßü‡¶æ‡¶§</span>
          </div>
        </div>
      </div>

      <div class="content-scroll" id="contentScroll">
        <!-- Ayaat cards rendered by JS -->
      </div>

      <div id="fullscreenHint" class="fullscreen-hint" style="display:none;">
        ‡¶´‡ßÅ‡¶≤-‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶® ‡¶Æ‡ßã‡¶°: ‡¶ï‡¶®‡ßç‡¶ü‡ßç‡¶∞‡ßã‡¶≤ ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶®‡ßá ‡¶ü‡ßç‡¶Ø‡¶æ‡¶™ ‡¶ï‡¶∞‡ßÅ‡¶®
      </div>

    </main>
  </div>

  <!-- Word meaning popup -->
  <div id="wordPopup" class="word-popup" style="display:none;">
    <div class="word-popup-header">
      <div class="word-popup-title">
        <div class="word-popup-ar" id="wordPopupAr"></div>
        <div class="word-popup-bn" id="wordPopupBn"></div>
      </div>
      <button class="word-popup-close" id="wordPopupClose">‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶® ‚úï</button>
    </div>
    <div class="word-popup-notes" id="wordPopupNotes"></div>
  </div>

  <!-- Settings modal -->
  <div id="settingsBackdrop" class="settings-modal-backdrop" style="display:none;">
    <div class="settings-modal">
      <div class="settings-header">
        <div class="settings-title">‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏</div>
        <button class="settings-close-btn" id="settingsCloseBtn">‡¶¨‡¶®‡ßç‡¶ß</button>
      </div>

      <div class="settings-section">
        <div class="settings-section-title">‡¶Ö‡¶®‡ßÅ‡¶¨‡¶æ‡¶¶ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶®</div>
        <div class="toggle-row">
          <label>‡¶§‡¶æ‡¶´‡¶∏‡ßÄ‡¶∞‡ßá ‡¶ì‡¶∏‡¶Æ‡¶æ‡¶®‡ßÄ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶ì</label>
          <div class="toggle-input" id="toggleOsmani"></div>
        </div>
        <div class="toggle-row">
          <label>‡¶§‡¶æ‡¶ì‡¶Ø‡ßÄ‡¶π‡ßÅ‡¶≤ ‡¶ï‡ßÅ‡¶∞‡¶Ü‡¶® ‡¶¶‡ßá‡¶ñ‡¶æ‡¶ì</label>
          <div class="toggle-input" id="toggleTawjih"></div>
        </div>
      </div>

      <div class="settings-section">
        <div class="settings-section-title">‡¶∞‡¶ø‡¶°‡¶ø‡¶Ç ‡¶Æ‡ßã‡¶°</div>
        <div class="toggle-row">
          <label>‡¶´‡ßÅ‡¶≤-‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶® ‡¶∞‡¶ø‡¶°‡¶ø‡¶Ç (‡¶ü‡¶™‡¶¨‡¶æ‡¶∞ ‡¶π‡¶æ‡¶á‡¶°)</label>
          <div class="toggle-input" id="toggleFullscreen"></div>
        </div>
      </div>

      <div class="settings-section">
        <div class="settings-section-title">‡¶´‡¶®‡ßç‡¶ü ‡¶∏‡¶æ‡¶á‡¶ú</div>

        <div class="font-control-row">
          <div class="font-control-label">Arabic font size</div>
          <div class="font-control-inputs">
            <input type="number" class="font-number-input" id="fontArabicNumber" min="18" max="40" />
            <input type="range" class="font-range-input" id="fontArabicRange" min="18" max="40" />
          </div>
        </div>

        <div class="font-control-row">
          <div class="font-control-label">Bangla main (‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü ‡¶Ö‡¶®‡ßÅ‡¶¨‡¶æ‡¶¶)</div>
          <div class="font-control-inputs">
            <input type="number" class="font-number-input" id="fontBanglaNumber" min="12" max="26" />
            <input type="range" class="font-range-input" id="fontBanglaRange" min="12" max="26" />
          </div>
        </div>

        <div class="font-control-row">
          <div class="font-control-label">‡¶§‡¶æ‡¶´‡¶∏‡ßÄ‡¶∞‡ßá ‡¶ì‡¶∏‡¶Æ‡¶æ‡¶®‡ßÄ + ‡¶§‡¶æ‡¶ì‡¶Ø‡ßÄ‡¶π‡ßÅ‡¶≤ ‡¶ï‡ßÅ‡¶∞‡¶Ü‡¶®</div>
          <div class="font-control-inputs">
            <input type="number" class="font-number-input" id="fontTransNumber" min="12" max="26" />
            <input type="range" class="font-range-input" id="fontTransRange" min="12" max="26" />
          </div>
        </div>

        <div class="font-control-row">
          <div class="font-control-label">Word-by-word ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ ‡¶Ö‡¶∞‡ßç‡¶•</div>
          <div class="font-control-inputs">
            <input type="number" class="font-number-input" id="fontWordMeaningNumber" min="12" max="24" />
            <input type="range" class="font-range-input" id="fontWordMeaningRange" min="12" max="24" />
          </div>
        </div>

        <div class="font-control-row">
          <div class="font-control-label">Grammar notes</div>
          <div class="font-control-inputs">
            <input type="number" class="font-number-input" id="fontGrammarNumber" min="11" max="22" />
            <input type="range" class="font-range-input" id="fontGrammarRange" min="11" max="22" />
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Pins & favourites modal (simple placeholder) -->
  <div id="pinsFavBackdrop" class="settings-modal-backdrop" style="display:none;">
    <div class="settings-modal">
      <div class="settings-header">
        <div class="settings-title">üìå Pin / ‚≠ê Favourite</div>
        <button class="settings-close-btn" id="pinsFavCloseBtn">‡¶¨‡¶®‡ßç‡¶ß</button>
      </div>
      <div style="font-size:12px; color:var(--text-soft);">
        ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶™‡¶∞‡ßá folder-wise pin / favourite management ‡¶ï‡¶∞‡¶æ ‡¶π‡¶¨‡ßá ‡¶á‡¶®‡¶∂‡¶æ‡¶Ü‡¶≤‡ßç‡¶≤‡¶æ‡¶π‡•§
      </div>
    </div>
  </div>

  <script>
    /* ==============================
       Basic data placeholders
       (Relies on external suras.js + surah_XXX.json)
    =============================== */

    let suras = window.suras || []; // expect suras.js to define window.suras
    let currentSuraNumber = null;
    let currentSuraData = null;

    // localStorage keys
    const LS_KEY_LAST_READ = "qwb_last_read";
    const LS_KEY_SETTINGS = "qwb_settings";

    // settings state
    let settings = {
      showOsmani: true,
      showTawjih: true,
      fullscreen: false,
      fontArabic: 26,
      fontBangla: 16,
      fontTrans: 15,
      fontWordMeaning: 14,
      fontGrammar: 13
    };

    function loadSettings() {
      try {
        const saved = JSON.parse(localStorage.getItem(LS_KEY_SETTINGS));
        if (saved) {
          settings = { ...settings, ...saved };
        }
      } catch (e) {}
    }

    function saveSettings() {
      localStorage.setItem(LS_KEY_SETTINGS, JSON.stringify(settings));
    }

    function applyFontSettings() {
      document.documentElement.style.setProperty(
        "--font-arabic-size",
        settings.fontArabic + "px"
      );
      document.documentElement.style.setProperty(
        "--font-bangla-size",
        settings.fontBangla + "px"
      );
      document.documentElement.style.setProperty(
        "--font-translation-size",
        settings.fontTrans + "px"
      );
      document.documentElement.style.setProperty(
        "--font-word-meaning-size",
        settings.fontWordMeaning + "px"
      );
      document.documentElement.style.setProperty(
        "--font-grammar-size",
        settings.fontGrammar + "px"
      );
    }

    function initFontControls() {
      const map = [
        ["fontArabicNumber", "fontArabicRange", "fontArabic"],
        ["fontBanglaNumber", "fontBanglaRange", "fontBangla"],
        ["fontTransNumber", "fontTransRange", "fontTrans"],
        ["fontWordMeaningNumber", "fontWordMeaningRange", "fontWordMeaning"],
        ["fontGrammarNumber", "fontGrammarRange", "fontGrammar"]
      ];

      map.forEach(([numId, rangeId, key]) => {
        const numEl = document.getElementById(numId);
        const rangeEl = document.getElementById(rangeId);

        numEl.value = settings[key];
        rangeEl.value = settings[key];

        numEl.addEventListener("input", () => {
          let val = parseInt(numEl.value || rangeEl.min, 10);
          if (isNaN(val)) val = parseInt(rangeEl.min, 10);
          if (val < parseInt(rangeEl.min, 10))
            val = parseInt(rangeEl.min, 10);
          if (val > parseInt(rangeEl.max, 10))
            val = parseInt(rangeEl.max, 10);
          settings[key] = val;
          rangeEl.value = val;
          applyFontSettings();
          saveSettings();
        });

        rangeEl.addEventListener("input", () => {
          let val = parseInt(rangeEl.value, 10);
          settings[key] = val;
          numEl.value = val;
          applyFontSettings();
          saveSettings();
        });
      });
    }

    function updateToggleUI(id, active) {
      const el = document.getElementById(id);
      if (!el) return;
      if (active) el.classList.add("active");
      else el.classList.remove("active");
    }

    function initToggle(id, key) {
      const el = document.getElementById(id);
      updateToggleUI(id, !!settings[key]);
      el.addEventListener("click", () => {
        settings[key] = !settings[key];
        updateToggleUI(id, !!settings[key]);
        saveSettings();
        if (key === "fullscreen") {
          applyFullscreen();
        } else {
          // re-render current sura for translation show/hide
          if (currentSuraData) renderSura(currentSuraData);
        }
      });
    }

    function applyFullscreen() {
      const body = document.body;
      const hint = document.getElementById("fullscreenHint");
      if (settings.fullscreen) {
        body.classList.add("fullscreen");
        hint.style.display = "block";
        setTimeout(() => {
          hint.style.display = "none";
        }, 2500);
      } else {
        body.classList.remove("fullscreen");
        hint.style.display = "none";
      }
    }

    // Tapping main area toggles top-bar visibility in fullscreen
    let topVisibleInFullscreen = true;
    function initFullscreenTap() {
      const main = document.getElementById("mainArea");
      main.addEventListener("click", (e) => {
        if (!settings.fullscreen) return;
        // ignore clicks on buttons/inputs
        if (
          e.target.closest("button") ||
          e.target.closest("input") ||
          e.target.closest(".settings-modal") ||
          e.target.closest(".word-popup")
        ) {
          return;
        }
        const topBar = document.getElementById("topBar");
        topVisibleInFullscreen = !topVisibleInFullscreen;
        topBar.style.display = topVisibleInFullscreen ? "flex" : "none";
      });
    }

    function initSettingsModal() {
      const backdrop = document.getElementById("settingsBackdrop");
      const openBtn = document.getElementById("settingsBtn");
      const openBtnBottom = document.getElementById("openSettingsBottom");
      const closeBtn = document.getElementById("settingsCloseBtn");

      function open() {
        backdrop.style.display = "flex";
      }
      function close() {
        backdrop.style.display = "none";
      }

      openBtn.addEventListener("click", open);
      openBtnBottom.addEventListener("click", open);
      closeBtn.addEventListener("click", close);
      backdrop.addEventListener("click", (e) => {
        if (e.target === backdrop) close();
      });
    }

    function initPinsFavModal() {
      const backdrop = document.getElementById("pinsFavBackdrop");
      const openBtn = document.getElementById("openPinsFav");
      const closeBtn = document.getElementById("pinsFavCloseBtn");

      function open() {
        backdrop.style.display = "flex";
      }
      function close() {
        backdrop.style.display = "none";
      }
      openBtn.addEventListener("click", open);
      closeBtn.addEventListener("click", close);
      backdrop.addEventListener("click", (e) => {
        if (e.target === backdrop) close();
      });
    }

    function renderSuraList() {
      const container = document.getElementById("suraList");
      container.innerHTML = "";
      suras.forEach((s) => {
        const div = document.createElement("div");
        div.className = "sura-item";
        div.dataset.sura = s.number;
        div.innerHTML = `
          <div class="sura-info-main">
            <div class="sura-name-bn">${s.nameBn || ""}</div>
            <div class="sura-name-ar">${s.nameAr || ""}</div>
          </div>
          <div class="sura-meta">
            <div class="sura-badge">
              <span>#${s.number}</span>
              <span>‚Ä¢</span>
              <span>${s.ayahCount || "?"} ‡¶Ü‡ßü‡¶æ‡¶§</span>
            </div>
          </div>
        `;
        div.addEventListener("click", () => {
          loadSura(s.number);
        });
        container.appendChild(div);
      });
    }

    function highlightActiveSura() {
      const items = document.querySelectorAll(".sura-item");
      items.forEach((item) => {
        if (parseInt(item.dataset.sura, 10) === currentSuraNumber) {
          item.classList.add("active");
        } else {
          item.classList.remove("active");
        }
      });
    }

    function updateSuraHeader() {
      const titleEl = document.getElementById("suraHeaderTitle");
      const subEl = document.getElementById("suraHeaderSub");
      const revEl = document.getElementById("suraMetaRevelation");
      const ayatEl = document.getElementById("suraMetaAyat");
      const chip = document.getElementById("currentSuraChip");

      if (!currentSuraData) {
        titleEl.textContent = "‡¶∏‡ßÅ‡¶∞‡¶æ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®";
        subEl.textContent = "‡¶¨‡¶æ‡¶Æ ‡¶™‡¶æ‡¶∂ ‡¶•‡ßá‡¶ï‡ßá ‡¶ï‡ßã‡¶®‡ßã ‡¶∏‡ßÅ‡¶∞‡¶æ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®‡•§";
        revEl.textContent = "-";
        ayatEl.textContent = "- ‡¶Ü‡ßü‡¶æ‡¶§";
        chip.textContent = "‡¶ï‡ßã‡¶® ‡¶∏‡ßÅ‡¶∞‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡ßü‡¶®‡¶ø";
        return;
      }

      titleEl.textContent = currentSuraData.nameBn || "";
      subEl.textContent = currentSuraData.nameAr || "";
      revEl.textContent =
        (currentSuraData.revelationPlace || "").toLowerCase() === "makki"
          ? "‡¶Æ‡¶æ‡¶ï‡ßç‡¶ï‡ßÄ"
          : "‡¶Æ‡¶æ‡¶¶‡¶æ‡¶®‡ßÄ";
      ayatEl.textContent = (currentSuraData.ayahCount || "?") + " ‡¶Ü‡ßü‡¶æ‡¶§";

      chip.textContent =
        "‡¶∏‡ßÇ‡¶∞‡¶æ " +
        (currentSuraData.nameBn || "") +
        " (#" +
        currentSuraData.number +
        ")";
    }

    // === Word popup ===
    function showWordPopup(ar, bn, notes) {
      document.getElementById("wordPopupAr").textContent = ar || "";
      document.getElementById("wordPopupBn").textContent = bn || "";
      document.getElementById("wordPopupNotes").textContent = notes || "";
      document.getElementById("wordPopup").style.display = "block";
    }

    function hideWordPopup() {
      document.getElementById("wordPopup").style.display = "none";
      // remove active highlight from words
      document
        .querySelectorAll(".ayah-arabic-word.active")
        .forEach((el) => el.classList.remove("active"));
    }

    function initWordPopup() {
      document
        .getElementById("wordPopupClose")
        .addEventListener("click", hideWordPopup);
    }

    // === last read ===
    function saveLastRead(suraNum, ayahNum, preview) {
      const data = {
        sura: suraNum,
        ayah: ayahNum,
        preview: preview || ""
      };
      localStorage.setItem(LS_KEY_LAST_READ, JSON.stringify(data));
      updateLastReadUI();
    }

    function loadLastRead() {
      try {
        const saved = JSON.parse(localStorage.getItem(LS_KEY_LAST_READ));
        return saved || null;
      } catch (e) {
        return null;
      }
    }

    function updateLastReadUI() {
      const data = loadLastRead();
      const refEl = document.getElementById("lastReadRef");
      const previewEl = document.getElementById("lastReadPreview");
      if (!data) {
        refEl.textContent = "-";
        previewEl.textContent =
          "‡¶è‡¶ñ‡¶®‡ßã ‡¶ï‡ßã‡¶® ‡¶Ü‡ßü‡¶æ‡¶§‡¶ï‡ßá ‡¶∂‡ßá‡¶∑ ‡¶™‡ßú‡¶æ ‡¶π‡¶ø‡¶∏‡ßá‡¶¨‡ßá ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡¶®‡¶ø‡•§";
        return;
      }
      refEl.textContent = data.sura + ":" + data.ayah;
      previewEl.textContent = data.preview || "";
    }

    function initLastReadButtons() {
      document
        .getElementById("btnContinueLast")
        .addEventListener("click", () => {
          const data = loadLastRead();
          if (!data) return;
          // load sura and scroll to ayah
          loadSura(data.sura, data.ayah);
        });

      document.getElementById("btnClearLast").addEventListener("click", () => {
        localStorage.removeItem(LS_KEY_LAST_READ);
        updateLastReadUI();
      });
    }

    // === Surah loading ===
    async function loadSura(number, scrollToAyah = null) {
      currentSuraNumber = number;
      highlightActiveSura();

      try {
        // assume JSON file name like surah_103.json hosted in same folder
        const res = await fetch("surah_" + number + ".json");
        const data = await res.json();
        currentSuraData = data;
        renderSura(data);

        updateSuraHeader();

        if (scrollToAyah != null) {
          setTimeout(() => {
            const target = document.querySelector(
              '.ayah-card[data-ayah="' + scrollToAyah + '"]'
            );
            if (target) {
              target.scrollIntoView({ behavior: "smooth", block: "center" });
            }
          }, 200);
        }
      } catch (e) {
        console.error("Failed to load sura json", e);
      }
    }

    function renderSura(data) {
      const container = document.getElementById("contentScroll");
      container.innerHTML = "";

      // Bismillah if hasBismillah
      if (data.hasBismillah && data.bismillah) {
        const b = data.bismillah;
        const card = document.createElement("div");
        card.className = "ayah-card";
        card.innerHTML = `
          <div class="ayah-top-row">
            <div class="ayah-ref-badge">
              <span class="index">ÿ®ÿ≥ŸÖ ÿßŸÑŸÑŸá</span>
            </div>
            <div class="ayah-actions">
              <button class="more-btn" data-type="bismillah">‚ãØ</button>
              <div class="more-menu">
                <button data-action="pin"><span>üìå</span><span>Pin</span></button>
                <button data-action="fav"><span>‚≠ê</span><span>Favourite</span></button>
                <button data-action="last"><span>‚è±</span><span>Last read</span></button>
                <button data-action="copy"><span>üìã</span><span>Copy</span></button>
                <button data-action="share"><span>üîó</span><span>Share</span></button>
              </div>
            </div>
          </div>
          <div class="ayah-arabic-line">${b.arabic || ""}</div>
          <div class="ayah-bangla-main">${b.bangla || ""}</div>
        `;
        container.appendChild(card);
      }

      data.ayahs.forEach((a) => {
        const card = document.createElement("div");
        card.className = "ayah-card";
        card.dataset.ayah = a.ayahNumber;

        // build arabic words with word data
        let arabicHtml = "";
        if (a.words && a.words.length) {
          // if words list exists, join them; we assume each word entry has text
          a.words.forEach((w, idx) => {
            const t = w.text || "";
            arabicHtml += `<span class="ayah-arabic-word" data-word-index="${idx}">${t}</span> `;
          });
        } else {
          // fallback: whole arabic
          arabicHtml = `<span class="ayah-arabic-word" data-word-index="-1">${
            a.arabic || ""
          }</span>`;
        }

        // translations
        let translationsHtml = "";
        if (settings.showOsmani && a.translations && a.translations.osmani) {
          translationsHtml += `
            <div class="translation-item">
              <span class="translation-label">[‡¶ì‡¶∏‡¶Æ‡¶æ‡¶®‡ßÄ]</span>
              <span>${a.translations.osmani}</span>
            </div>
          `;
        }
        if (settings.showTawjih && a.translations && a.translations.tawjih) {
          translationsHtml += `
            <div class="translation-item">
              <span class="translation-label">[‡¶§‡¶æ‡¶ì‡¶Ø‡ßÄ‡¶π‡ßÅ‡¶≤]</span>
              <span>${a.translations.tawjih}</span>
            </div>
          `;
        }

        // word meaning & notes summary line
        let wordMeaningLine = "";
        let grammarLine = "";
        if (a.words && a.words.length) {
          const bnList = a.words
            .map((w) => w.meaningBn || "")
            .filter(Boolean)
            .join(" ¬∑ ");
          if (bnList) {
            wordMeaningLine = `<div class="word-meaning-line">${bnList}</div>`;
          }
          const notesList = a.words
            .map((w) => w.notes || "")
            .filter(Boolean)
            .join(" ");
          if (notesList) {
            grammarLine = `<div class="grammar-notes">${notesList}</div>`;
          }
        }

        card.innerHTML = `
          <div class="ayah-top-row">
            <div class="ayah-ref-badge">
              <span class="index">${data.number}:${a.ayahNumber}</span>
              <span>‚Ä¢</span>
              <span>Ayah ${a.ayahNumber}</span>
            </div>
            <div class="ayah-actions">
              <button class="more-btn" data-type="ayah" data-ayah="${a.ayahNumber}">‚ãØ</button>
              <div class="more-menu">
                <button data-action="pin"><span>üìå</span><span>Pin</span></button>
                <button data-action="fav"><span>‚≠ê</span><span>Favourite</span></button>
                <button data-action="last"><span>‚è±</span><span>Last read</span></button>
                <button data-action="copy"><span>üìã</span><span>Copy</span></button>
                <button data-action="share"><span>üîó</span><span>Share</span></button>
              </div>
            </div>
          </div>

          <div class="ayah-arabic-line">${arabicHtml}</div>
          <div class="ayah-bangla-main">${a.bangla || ""}</div>

          ${
            translationsHtml
              ? `<div class="ayah-translations">${translationsHtml}</div>`
              : ""
          }
          ${wordMeaningLine}
          ${grammarLine}
        `;
        container.appendChild(card);
      });

      // init word click events
      container.querySelectorAll(".ayah-arabic-word").forEach((el) => {
        el.addEventListener("click", () => {
          container
            .querySelectorAll(".ayah-arabic-word.active")
            .forEach((w) => w.classList.remove("active"));
          el.classList.add("active");

          const ayahCard = el.closest(".ayah-card");
          const ayahNum = parseInt(ayahCard.dataset.ayah || "-1", 10);
          const wordIdx = parseInt(el.dataset.wordIndex || "-1", 10);

          if (!currentSuraData || !currentSuraData.ayahs) return;
          const ayah = currentSuraData.ayahs.find(
            (x) => x.ayahNumber === ayahNum
          );
          if (!ayah) return;
          if (wordIdx >= 0 && ayah.words && ayah.words[wordIdx]) {
            const w = ayah.words[wordIdx];
            showWordPopup(w.text || "", w.meaningBn || "", w.notes || "");
          } else {
            showWordPopup(ayah.arabic || "", ayah.bangla || "", "");
          }
        });
      });

      // init more-menu per ayah
      container.querySelectorAll(".ayah-actions .more-btn").forEach((btn) => {
        btn.addEventListener("click", (e) => {
          e.stopPropagation();
          const menu = btn.nextElementSibling;
          const isOpen = menu.classList.contains("open");
          document
            .querySelectorAll(".more-menu.open")
            .forEach((m) => m.classList.remove("open"));
          if (!isOpen) menu.classList.add("open");
        });
      });

      container.querySelectorAll(".more-menu button").forEach((item) => {
        item.addEventListener("click", (e) => {
          e.stopPropagation();
          const action = item.dataset.action;
          const menu = item.closest(".more-menu");
          const btn = menu.previousElementSibling;
          const type = btn.dataset.type;
          if (type === "ayah") {
            const ayahNum = parseInt(btn.dataset.ayah, 10);
            handleAyahAction(action, data, ayahNum);
          } else if (type === "bismillah") {
            handleBismillahAction(action, data);
          }
          menu.classList.remove("open");
        });
      });

      // click outside closes menus
      document.addEventListener("click", () => {
        document
          .querySelectorAll(".more-menu.open")
          .forEach((m) => m.classList.remove("open"));
      });
    }

    function handleAyahAction(action, suraData, ayahNumber) {
      const ayah = suraData.ayahs.find((a) => a.ayahNumber === ayahNumber);
      if (!ayah) return;

      const fullText =
        (ayah.arabic || "") +
        "\n" +
        (ayah.bangla || "") +
        (ayah.translations && ayah.translations.osmani
          ? "\n[‡¶ì‡¶∏‡¶Æ‡¶æ‡¶®‡ßÄ] " + ayah.translations.osmani
          : "") +
        (ayah.translations && ayah.translations.tawjih
          ? "\n[‡¶§‡¶æ‡¶ì‡¶Ø‡ßÄ‡¶π‡ßÅ‡¶≤] " + ayah.translations.tawjih
          : "");

      if (action === "last") {
        saveLastRead(suraData.number, ayahNumber, ayah.bangla || "");
      } else if (action === "copy") {
        navigator.clipboard.writeText(fullText).catch(() => {});
      } else if (action === "share") {
        if (navigator.share) {
          navigator
            .share({
              title: "Qur'an " + suraData.nameBn + " " + suraData.number + ":" + ayahNumber,
              text: fullText
            })
            .catch(() => {});
        } else {
          navigator.clipboard.writeText(fullText).catch(() => {});
        }
      } else if (action === "pin") {
        // TODO: implement folders later; for now overwrite single pin
        // this is just a placeholder
        alert("Pin feature folder system later implement ‡¶ï‡¶∞‡¶¨ ‡¶á‡¶®‡¶∂‡¶æ‡¶Ü‡¶≤‡ßç‡¶≤‡¶æ‡¶π‡•§");
      } else if (action === "fav") {
        alert("Favourite folder system ‡¶™‡¶∞‡ßá ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶¨‡ßá ‡¶á‡¶®‡¶∂‡¶æ‡¶Ü‡¶≤‡ßç‡¶≤‡¶æ‡¶π‡•§");
      }
    }

    function handleBismillahAction(action, suraData) {
      const b = suraData.bismillah;
      if (!b) return;
      const fullText = (b.arabic || "") + "\n" + (b.bangla || "");

      if (action === "last") {
        saveLastRead(suraData.number, 0, b.bangla || "");
      } else if (action === "copy") {
        navigator.clipboard.writeText(fullText).catch(() => {});
      } else if (action === "share") {
        if (navigator.share) {
          navigator
            .share({
              title: "Bismillah - Surah " + suraData.nameBn,
              text: fullText
            })
            .catch(() => {});
        } else {
          navigator.clipboard.writeText(fullText).catch(() => {});
      } else if (action === "pin" || action === "fav") {
        alert("Pin/Fav Bismillah feature ‡¶™‡¶∞‡ßá ‡¶∏‡ßÅ‡¶®‡ßç‡¶¶‡¶∞‡¶≠‡¶æ‡¶¨‡ßá ‡¶ï‡¶∞‡¶æ ‡¶π‡¶¨‡ßá ‡¶á‡¶®‡¶∂‡¶æ‡¶Ü‡¶≤‡ßç‡¶≤‡¶æ‡¶π‡•§");
      }
      }
    }

    function initSidebarToggle() {
      const sidebar = document.getElementById("sidebar");
      const openBtn = document.getElementById("sidebarOpen");
      const closeBtn = document.getElementById("sidebarClose");

      openBtn.addEventListener("click", () => {
        sidebar.classList.add("open");
      });
      closeBtn.addEventListener("click", () => {
        sidebar.classList.remove("open");
      });
    }

    function initSuraSearch() {
      const input = document.getElementById("suraSearchInput");
      input.addEventListener("input", () => {
        const q = input.value.trim().toLowerCase();
        const items = document.querySelectorAll(".sura-item");
        items.forEach((item) => {
          const num = item.dataset.sura + "";
          const bn = item.querySelector(".sura-name-bn").textContent.toLowerCase();
          const ar = item.querySelector(".sura-name-ar").textContent.toLowerCase();
          if (
            num.includes(q) ||
            bn.includes(q) ||
            ar.includes(q)
          ) {
            item.style.display = "";
          } else {
            item.style.display = "none";
          }
        });
      });
    }

    // Init everything
    document.addEventListener("DOMContentLoaded", () => {
      loadSettings();
      applyFontSettings();

      initFontControls();
      initSettingsModal();
      initPinsFavModal();
      initWordPopup();
      initLastReadButtons();
      initSidebarToggle();
      initSuraSearch();
      initFullscreenTap();

      initToggle("toggleOsmani", "showOsmani");
      initToggle("toggleTawjih", "showTawjih");
      initToggle("toggleFullscreen", "fullscreen");
      applyFullscreen();

      renderSuraList();
      updateLastReadUI();

      // if last read sura available, can auto load that sura
      const last = loadLastRead();
      if (last && last.sura) {
        loadSura(last.sura, last.ayah);
      } else if (suras && suras.length > 0) {
        // default load first sura
        loadSura(suras[0].number);
      }
    });
  </script>

  <!-- external suras.js should define window.suras -->
  <script src="suras.js"></script>
</body>
</html>
